<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>التاريخ الهجري والميلادي | تقويم أم القرى مع مواقيت الصلاة</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        :root { --primary-color: #2c5f2d; --secondary-color: #97bc62; --accent-color: #f0f7da; --text-color: #333; --light-bg: #f9f9f9; --shadow: 0 5px 15px rgba(0, 0, 0, 0.1); }
        body { background-color: var(--light-bg); color: var(--text-color); line-height: 1.6; background-image: linear-gradient(135deg, #f5f7fa 0%, #e4efe9 100%); min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        /* الهيدر بنفس تنسيق صفحة القرآن */
        header { text-align: center; padding: 20px; background: linear-gradient(to right, var(--primary-color), var(--secondary-color)); color: white; border-radius: 15px; margin-bottom: 30px; box-shadow: var(--shadow); }
        .header-top { display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 15px; }
        .logo { width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, #c8a04f, #f0d58c); display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 6px rgba(0,0,0,0.3); margin-left: 10px; text-decoration: none; }
        .logo i { font-size: 26px; color: white; }
        .page-title { margin: 0; font-size: 28px; direction: rtl; text-align: right; flex: 1; margin-right: 10px; }
        
        .basmala { font-size: 1.8rem; margin-bottom: 10px; color: #f0f7da; font-weight: 600; }
        .subtitle { font-size: 1.2rem; opacity: 0.9; margin-bottom: 10px; }
        
        /* قسم التواريخ في المنتصف */
        .dates-center-section { background-color: white; border-radius: 15px; padding: 30px; margin-bottom: 30px; box-shadow: var(--shadow); text-align: center; }
        .dates-title { font-size: 1.8rem; color: var(--primary-color); margin-bottom: 25px; padding-bottom: 10px; border-bottom: 2px solid var(--secondary-color); display: flex; align-items: center; justify-content: center; gap: 10px; }
        .dates-title i { color: var(--secondary-color); }
        
        .dates-display { display: flex; flex-direction: column; gap: 30px; align-items: center; }
        .date-row { display: flex; justify-content: center; gap: 40px; width: 100%; flex-wrap: wrap; }
        .date-card { background-color: var(--accent-color); border-radius: 12px; padding: 25px; min-width: 300px; text-align: center; border: 2px solid transparent; transition: all 0.3s; }
        .date-card:hover { border-color: var(--primary-color); transform: translateY(-5px); }
        .date-type { font-size: 1.3rem; color: var(--primary-color); margin-bottom: 15px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .date-value { font-size: 2.2rem; font-weight: bold; color: var(--text-color); margin-bottom: 10px; line-height: 1.3; }
        .date-details { color: #666; font-size: 1rem; }
        
        /* قسم مواقيت الصلاة */
        .prayer-section { background-color: white; border-radius: 15px; padding: 25px; margin-bottom: 30px; box-shadow: var(--shadow); }
        .section-title { font-size: 1.8rem; color: var(--primary-color); margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid var(--secondary-color); display: flex; align-items: center; gap: 10px; }
        .section-title i { color: var(--secondary-color); }
        
        .location-selector { margin-bottom: 20px; }
        .location-label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--primary-color); }
        .location-controls { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .location-btn { background-color: var(--primary-color); color: white; border: none; padding: 10px 15px; border-radius: 25px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 8px; font-size: 0.9rem; }
        .location-btn:hover { background-color: var(--secondary-color); }
        .city-select { width: 100%; padding: 12px 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 1rem; background-color: white; transition: all 0.3s; }
        .city-select:focus { border-color: var(--secondary-color); outline: none; }
        
        .current-location { background-color: #e8f5e9; padding: 12px; border-radius: 10px; margin-bottom: 20px; text-align: center; color: var(--primary-color); font-weight: 600; }
        
        .prayer-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; margin-top: 20px; }
        .prayer-card { background-color: var(--accent-color); border-radius: 10px; padding: 15px; text-align: center; border-top: 4px solid var(--primary-color); transition: all 0.3s; }
        .prayer-card:hover { transform: translateY(-3px); }
        .prayer-name { font-weight: 700; font-size: 1.2rem; color: var(--primary-color); margin-bottom: 5px; }
        .prayer-time { font-size: 1.5rem; font-weight: bold; color: var(--text-color); }
        .next-prayer { background-color: var(--primary-color); color: white; }
        .next-prayer .prayer-name, .next-prayer .prayer-time { color: white; }
        
        /* قسم الموارد */
        .resources-section { margin-top: 40px; }
        .resources-title { font-size: 2rem; color: var(--primary-color); text-align: center; margin-bottom: 30px; position: relative; padding-bottom: 15px; }
        .resources-title:after { content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 150px; height: 3px; background: linear-gradient(to right, var(--primary-color), var(--secondary-color)); border-radius: 2px; }
        .resources { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; }
        .resource-card { background-color: white; border-radius: 12px; padding: 25px; box-shadow: var(--shadow); transition: all 0.3s; border-top: 4px solid var(--primary-color); display: flex; flex-direction: column; height: 100%; }
        .resource-card:hover { transform: translateY(-8px); box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15); }
        .resource-icon { font-size: 2.5rem; color: var(--primary-color); margin-bottom: 15px; text-align: center; }
        .resource-title { font-size: 1.4rem; color: var(--primary-color); margin-bottom: 10px; text-align: center; font-weight: 700; }
        .resource-desc { color: #555; line-height: 1.7; margin-bottom: 20px; flex-grow: 1; font-size: 0.95rem; }
        .resource-btn { background: linear-gradient(to right, var(--primary-color), var(--secondary-color)); color: white; border: none; padding: 12px 20px; border-radius: 25px; font-weight: 600; cursor: pointer; transition: all 0.3s; text-align: center; text-decoration: none; display: block; font-size: 0.95rem; }
        .resource-btn:hover { background: linear-gradient(to right, #245025, #7ca34a); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(44, 95, 45, 0.3); }
        
        footer { text-align: center; padding: 30px 0; margin-top: 50px; color: #666; border-top: 1px solid #ddd; }
        .warning { color: #d32f2f; background-color: #ffebee; padding: 15px; border-radius: 10px; margin-top: 20px; text-align: center; font-weight: 600; }
        .loading { color: var(--primary-color); text-align: center; padding: 20px; font-size: 1.1rem; }
        .success-message { color: #2c5f2d; background-color: #e8f5e9; padding: 10px; border-radius: 5px; margin-top: 10px; text-align: center; }
        
        @media (max-width: 768px) { 
            .header-top { flex-direction: column; gap: 15px; }
            .page-title { font-size: 1.8rem; text-align: center; margin: 0; }
            .basmala { font-size: 1.5rem; }
            .dates-title, .section-title { font-size: 1.5rem; }
            .date-value { font-size: 1.8rem; }
            .date-row { flex-direction: column; gap: 20px; }
            .date-card { min-width: 100%; }
            .resources { grid-template-columns: 1fr; }
            .prayer-grid { grid-template-columns: repeat(2, 1fr); }
            .location-controls { flex-direction: column; }
            .location-btn { width: 100%; justify-content: center; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <a href="https://hikmavideohub-bot.github.io/Quraan/" class="logo">
                    <i class="fas fa-quran"></i>
                </a>
                <h1 class="page-title">التاريخ الهجري والميلادي</h1>
            </div>
            
            <div class="basmala">بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ</div>
            <p class="subtitle">تقويم أم القرى الرسمي مع مواقيت الصلاة حسب موقعك</p>
        </header>
        
        <!-- قسم التواريخ في المنتصف -->
        <section class="dates-center-section" aria-label="التواريخ الحالية">
            <h2 class="dates-title"><i class="fas fa-calendar-alt"></i> التواريخ الحالية</h2>
            <div class="dates-display">
                <div class="date-row">
                    <div class="date-card">
                        <div class="date-type">
                            <i class="fas fa-moon"></i> التاريخ الهجري
                        </div>
                        <div class="date-value" id="hijri-date">جاري التحميل...</div>
                        <div class="date-details" id="hijri-details"></div>
                    </div>
                    
                    <div class="date-card">
                        <div class="date-type">
                            <i class="fas fa-sun"></i> التاريخ الميلادي
                        </div>
                        <div class="date-value" id="gregorian-date">جاري التحميل...</div>
                        <div class="date-details" id="gregorian-details"></div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- قسم مواقيت الصلاة -->
        <section class="prayer-section" aria-label="مواقيت الصلاة">
            <h2 class="section-title"><i class="fas fa-clock"></i> مواقيت الصلاة</h2>
            
            <div class="location-selector">
                <label class="location-label"><i class="fas fa-map-marker-alt"></i> اختر موقعك لمواقيت الصلاة:</label>
                
                <div class="location-controls">
                    <button class="location-btn" id="gps-btn">
                        <i class="fas fa-location-arrow"></i> استخدام موقعي الحالي
                    </button>
                    <button class="location-btn" id="makkah-btn">
                        <i class="fas fa-kaaba"></i> مكة المكرمة
                    </button>
                    <button class="location-btn" id="madina-btn">
                        <i class="fas fa-mosque"></i> المدينة المنورة
                    </button>
                </div>
                
                <select class="city-select" id="city-select">
                    <option value="">أو اختر مدينة محددة</option>
                    <option value="Riyadh,Saudi Arabia">الرياض، السعودية</option>
                    <option value="Jeddah,Saudi Arabia">جدة، السعودية</option>
                    <option value="Dammam,Saudi Arabia">الدمام، السعودية</option>
                    <option value="Cairo,Egypt">القاهرة، مصر</option>
                    <option value="Dubai,UAE">دبي، الإمارات</option>
                    <option value="Amman,Jordan">عمّان، الأردن</option>
                    <option value="Beirut,Lebanon">بيروت، لبنان</option>
                    <option value="Istanbul,Turkey">إسطنبول، تركيا</option>
                </select>
            </div>
            
            <div class="current-location" id="current-location" style="display: none;">
                <i class="fas fa-info-circle"></i> موقعك الحالي: <span id="location-name">جاري تحديد الموقع...</span>
            </div>
            
            <div class="loading" id="prayer-loading">جاري تحميل مواقيت الصلاة...</div>
            
            <div class="prayer-grid" id="prayer-grid" style="display: none;">
                <!-- سيتم ملؤها بواسطة JavaScript -->
            </div>
            
            <div class="warning" id="prayer-error" style="display: none;">
                <i class="fas fa-exclamation-triangle"></i> تعذر تحميل مواقيت الصلاة. يرجى التأكد من اتصال الإنترنت أو اختيار موقع آخر.
            </div>
        </section>
        
        <section class="resources-section" aria-label="موارد إسلامية">
            <h2 class="resources-title"><i class="fas fa-mosque"></i> موارد إسلامية مفيدة</h2>
            
            <div class="resources">
                <div class="resource-card">
                    <div class="resource-icon">
                        <i class="fas fa-quran"></i>
                    </div>
                    <h3 class="resource-title">القرآن الكريم</h3>
                    <p class="resource-desc">الاستماع إلى القرآن الكريم بصوت أي قارئ من اختيارك مع تفسير الآيات وتلاوات متعددة.</p>
                    <a href="https://hikmavideohub-bot.github.io/Quraan/" target="_blank" class="resource-btn">الذهاب إلى الموقع</a>
                </div>
                
                <div class="resource-card">
                    <div class="resource-icon">
                        <i class="fas fa-kaaba"></i>
                    </div>
                    <h3 class="resource-title">بث مباشر الحرم المكي</h3>
                    <p class="resource-desc">مشاهدة البث المباشر للحرم المكي والمسجد النبوي وأداء الصلوات مع المصلين.</p>
                    <a href="https://youtu.be/7-Qf3g-0xEI" target="_blank" class="resource-btn">مشاهدة البث المباشر</a>
                </div>
                
                <div class="resource-card">
                    <div class="resource-icon">
                        <i class="fas fa-tv"></i>
                    </div>
                    <h3 class="resource-title">بث مباشر قناة السنة</h3>
                    <p class="resource-desc">مشاهدة بث مباشر لقناة السنة النبوية مع برامج دينية وفتاوى وشروحات للحديث.</p>
                    <a href="https://live.tvquran.net/saudi_sunnah" target="_blank" class="resource-btn">مشاهدة القناة</a>
                </div>
                
                <div class="resource-card">
                    <div class="resource-icon">
                        <i class="fas fa-pray"></i>
                    </div>
                    <h3 class="resource-title">حصن المسلم</h3>
                    <p class="resource-desc">كتاب حصن المسلم من أذكار الكتاب والسنة يجمع أذكار وأدعية النبي صلى الله عليه وسلم الصحيحة في مختلف مجالات الحياة اليومية.</p>
                    <a href="https://www.hisnmuslim.com/" target="_blank" class="resource-btn">تصفح الأذكار</a>
                </div>
                
                <div class="resource-card">
                    <div class="resource-icon">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <h3 class="resource-title">صحيح البخاري ومسلم</h3>
                    <p class="resource-desc">قراءة صحيح البخاري وصحيح مسلم كاملين مع شرح الأحاديث وتخريجها وبيان درجتها.</p>
                    <a href="https://sunnah.com" target="_blank" class="resource-btn">قراءة الأحاديث</a>
                </div>
                
                <div class="resource-card">
                    <div class="resource-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <h3 class="resource-title">التقويم الهجري</h3>
                    <p class="resource-desc">تقويم أم القرى الرسمي مع تواريخ الأحداث الإسلامية والأعياد ومواسم العبادات.</p>
                    <a href="https://hikmavideohub-bot.github.io/hijri-date" target="_blank" class="resource-btn">عرض التقويم</a>
                </div>
                
                <div class="resource-card">
                    <div class="resource-icon">
                        <i class="fas fa-globe-asia"></i>
                    </div>
                    <h3 class="resource-title">مواقيت الصلاة العالمية</h3>
                    <p class="resource-desc">معرفة مواقيت الصلاة في أي مدينة حول العالم مع اتجاه القبلة والأذان والتقويم الإسلامي.</p>
                    <a href="https://islamicfinder.org/world" target="_blank" class="resource-btn">معرفة المواقيت</a>
                </div>
            </div>
        </section>
        
        <footer>
            <p>التقويم الهجري &copy; <span id="current-year">2024</span> - صمم بحب لنشر الموارد الإسلامية</p>
            <p style="margin-top: 10px; font-size: 0.9rem;">يتم تحديث التواريخ ومواقيت الصلاة تلقائياً باستخدام API: https://api.aladhan.com</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // حفظ سنة التاريخ
            document.getElementById('current-year').textContent = new Date().getFullYear();
            
            // تعريف المتغيرات
            const hijriDateElement = document.getElementById('hijri-date');
            const hijriDetailsElement = document.getElementById('hijri-details');
            const gregorianDateElement = document.getElementById('gregorian-date');
            const gregorianDetailsElement = document.getElementById('gregorian-details');
            const prayerLoadingElement = document.getElementById('prayer-loading');
            const prayerGridElement = document.getElementById('prayer-grid');
            const prayerErrorElement = document.getElementById('prayer-error');
            const currentLocationElement = document.getElementById('current-location');
            const locationNameElement = document.getElementById('location-name');
            const gpsBtn = document.getElementById('gps-btn');
            const makkahBtn = document.getElementById('makkah-btn');
            const madinaBtn = document.getElementById('madina-btn');
            const citySelect = document.getElementById('city-select');
            
            // مصفوفة أسماء الشهور العربية الميلادية
            const gregorianMonthsArabic = [
                "يناير", "فبراير", "مارس", "أبريل", "مايو", "يونيو",
                "يوليو", "أغسطس", "سبتمبر", "أكتوبر", "نوفمبر", "ديسمبر"
            ];
            
            // مصفوفة أيام الأسبوع العربية
            const weekdaysArabic = [
                "الأحد", "الاثنين", "الثلاثاء", "الأربعاء", 
                "الخميس", "الجمعة", "السبت"
            ];
            
            // الموقع الحالي (افتراضي: مكة المكرمة)
            let currentLocation = { lat: 21.4225, lng: 39.8262, city: "مكة المكرمة", country: "السعودية" };
            
            // دالة لتحميل التواريخ
            async function loadDates() {
                try {
                    const response = await fetch('https://api.aladhan.com/v1/timingsByAddress?address=Mecca');
                    const data = await response.json();
                    
                    if (data.code === 200) {
                        // عرض التاريخ الهجري
                        const hijri = data.data.date.hijri;
                        hijriDateElement.textContent = `${hijri.day} ${hijri.month.ar} ${hijri.year} هـ`;
                        hijriDetailsElement.innerHTML = `
                            <strong>اليوم:</strong> ${hijri.weekday.ar} | 
                            <strong>الشهر:</strong> ${hijri.month.ar} | 
                            <strong>السنة:</strong> ${hijri.year}
                        `;
                        
                        // عرض التاريخ الميلادي - الإصلاح هنا
                        const gregorian = data.data.date.gregorian;
                        const gregorianDay = gregorian.day;
                        const gregorianMonthNum = parseInt(gregorian.month.number);
                        
                        // استخدام اسم الشهر العربي من المصفوفة
                        let gregorianMonthName = gregorianMonthsArabic[gregorianMonthNum - 1];
                        if (!gregorianMonthName) {
                            // إذا لم يوجد في المصفوفة، استخدم الاسم الإنجليزي
                            gregorianMonthName = gregorian.month.en;
                        }
                        
                        const gregorianYear = gregorian.year;
                        
                        // حساب يوم الأسبوع
                        const dateObj = new Date(gregorianYear, gregorianMonthNum - 1, gregorianDay);
                        const weekdayNum = dateObj.getDay();
                        const weekdayName = weekdaysArabic[weekdayNum];
                        
                        gregorianDateElement.textContent = `${gregorianDay} ${gregorianMonthName} ${gregorianYear} م`;
                        gregorianDetailsElement.innerHTML = `
                            <strong>اليوم:</strong> ${weekdayName} | 
                            <strong>الشهر:</strong> ${gregorianMonthName} | 
                            <strong>السنة:</strong> ${gregorianYear}
                        `;
                    }
                } catch (error) {
                    console.error('Error loading dates:', error);
                    loadDefaultDates();
                }
            }
            
            // دالة لتحميل التواريخ الافتراضية في حالة فشل API
            function loadDefaultDates() {
                const today = new Date();
                
                // التاريخ الميلادي الافتراضي
                const gregorianDay = today.getDate();
                const gregorianMonthNum = today.getMonth();
                const gregorianMonthName = gregorianMonthsArabic[gregorianMonthNum];
                const gregorianYear = today.getFullYear();
                const weekdayName = weekdaysArabic[today.getDay()];
                
                gregorianDateElement.textContent = `${gregorianDay} ${gregorianMonthName} ${gregorianYear} م`;
                gregorianDetailsElement.innerHTML = `
                    <strong>اليوم:</strong> ${weekdayName} | 
                    <strong>الشهر:</strong> ${gregorianMonthName} | 
                    <strong>السنة:</strong> ${gregorianYear}
                `;
                
                // التاريخ الهجري التقريبي الافتراضي
                const hijriYear = Math.round((today.getFullYear() - 622) * (33/32));
                const hijriMonth = today.getMonth() + 1;
                const hijriDay = today.getDate();
                const hijriMonths = ["محرم", "صفر", "ربيع الأول", "ربيع الثاني", "جمادى الأولى", "جمادى الآخرة", "رجب", "شعبان", "رمضان", "شوال", "ذو القعدة", "ذو الحجة"];
                const hijriMonthName = hijriMonths[hijriMonth - 1] || "غير معروف";
                const hijriWeekdayName = weekdaysArabic[today.getDay()];
                
                hijriDateElement.textContent = `${hijriDay} ${hijriMonthName} ${hijriYear} هـ`;
                hijriDetailsElement.innerHTML = `
                    <strong>اليوم:</strong> ${hijriWeekdayName} | 
                    <strong>الشهر:</strong> ${hijriMonthName} | 
                    <strong>السنة:</strong> ${hijriYear}
                `;
            }
            
            // دالة لتحميل مواقيت الصلاة حسب الموقع
            async function loadPrayerTimes(location) {
                try {
                    prayerLoadingElement.style.display = 'block';
                    prayerGridElement.style.display = 'none';
                    prayerErrorElement.style.display = 'none';
                    
                    let apiUrl;
                    if (location.city) {
                        // استخدام اسم المدينة
                        apiUrl = `https://api.aladhan.com/v1/timingsByAddress?address=${encodeURIComponent(location.city)}&method=4`;
                    } else {
                        // استخدام الإحداثيات
                        apiUrl = `https://api.aladhan.com/v1/timings/${Math.floor(Date.now()/1000)}?latitude=${location.lat}&longitude=${location.lng}&method=4`;
                    }
                    
                    const response = await fetch(apiUrl);
                    const data = await response.json();
                    
                    if (data.code === 200) {
                        // عرض معلومات الموقع
                        currentLocationElement.style.display = 'block';
                        locationNameElement.textContent = `${location.city}, ${location.country}`;
                        
                        // تحديث التواريخ أيضًا من البيانات الجديدة
                        const hijri = data.data.date.hijri;
                        const gregorian = data.data.date.gregorian;
                        
                        // تحديث التاريخ الهجري
                        hijriDateElement.textContent = `${hijri.day} ${hijri.month.ar} ${hijri.year} هـ`;
                        hijriDetailsElement.innerHTML = `
                            <strong>اليوم:</strong> ${hijri.weekday.ar} | 
                            <strong>الشهر:</strong> ${hijri.month.ar} | 
                            <strong>السنة:</strong> ${hijri.year}
                        `;
                        
                        // تحديث التاريخ الميلادي
                        const gregorianDay = gregorian.day;
                        const gregorianMonthNum = parseInt(gregorian.month.number);
                        const gregorianMonthName = gregorianMonthsArabic[gregorianMonthNum - 1] || gregorian.month.en;
                        const gregorianYear = gregorian.year;
                        
                        const dateObj = new Date(gregorianYear, gregorianMonthNum - 1, gregorianDay);
                        const weekdayNum = dateObj.getDay();
                        const weekdayName = weekdaysArabic[weekdayNum];
                        
                        gregorianDateElement.textContent = `${gregorianDay} ${gregorianMonthName} ${gregorianYear} م`;
                        gregorianDetailsElement.innerHTML = `
                            <strong>اليوم:</strong> ${weekdayName} | 
                            <strong>الشهر:</strong> ${gregorianMonthName} | 
                            <strong>السنة:</strong> ${gregorianYear}
                        `;
                        
                        // عرض مواقيت الصلاة
                        const timings = data.data.timings;
                        
                        // إخفاء رسالة التحميل
                        prayerLoadingElement.style.display = 'none';
                        prayerGridElement.style.display = 'grid';
                        
                        // تنظيف المحتوى القديم
                        prayerGridElement.innerHTML = '';
                        
                        // قائمة مواقيت الصلاة المراد عرضها
                        const prayersToShow = [
                            { name: 'الفجر', key: 'Fajr', icon: 'fas fa-sun' },
                            { name: 'الشروق', key: 'Sunrise', icon: 'fas fa-sunrise' },
                            { name: 'الظهر', key: 'Dhuhr', icon: 'fas fa-sun' },
                            { name: 'العصر', key: 'Asr', icon: 'fas fa-sun' },
                            { name: 'المغرب', key: 'Maghrib', icon: 'fas fa-sunset' },
                            { name: 'العشاء', key: 'Isha', icon: 'fas fa-moon' }
                        ];
                        
                        // تحديد وقت الصلاة التالي
                        const now = new Date();
                        const currentTime = now.getHours() * 60 + now.getMinutes();
                        let nextPrayer = null;
                        let minTimeDiff = Infinity;
                        
                        prayersToShow.forEach(prayer => {
                            if (timings[prayer.key]) {
                                const [hours, minutes] = timings[prayer.key].split(':').map(Number);
                                const prayerTime = hours * 60 + minutes;
                                let timeDiff = prayerTime - currentTime;
                                
                                // إذا كان وقت الصلاة قد مضى اليوم، أضف 24 ساعة (1440 دقيقة)
                                if (timeDiff < 0) {
                                    timeDiff += 1440;
                                }
                                
                                if (timeDiff < minTimeDiff) {
                                    minTimeDiff = timeDiff;
                                    nextPrayer = prayer.key;
                                }
                            }
                        });
                        
                        // إضافة مواقيت الصلاة إلى الشبكة
                        prayersToShow.forEach(prayer => {
                            const prayerCard = document.createElement('div');
                            prayerCard.className = 'prayer-card';
                            
                            // تحديد إذا كانت هذه الصلاة هي التالية
                            if (prayer.key === nextPrayer) {
                                prayerCard.classList.add('next-prayer');
                            }
                            
                            // تنسيق الوقت
                            let prayerTime = timings[prayer.key];
                            if (prayerTime && prayerTime.length >= 5) {
                                prayerTime = prayerTime.substring(0, 5);
                            }
                            
                            prayerCard.innerHTML = `
                                <div class="prayer-icon"><i class="${prayer.icon}"></i></div>
                                <div class="prayer-name">${prayer.name}</div>
                                <div class="prayer-time">${prayerTime || '--:--'}</div>
                            `;
                            
                            prayerGridElement.appendChild(prayerCard);
                        });
                        
                        // حفظ الموقع الحالي في localStorage
                        localStorage.setItem('lastPrayerLocation', JSON.stringify(location));
                    } else {
                        throw new Error('فشل في تحميل مواقيت الصلاة');
                    }
                } catch (error) {
                    console.error('Error loading prayer times:', error);
                    prayerLoadingElement.style.display = 'none';
                    prayerErrorElement.style.display = 'block';
                }
            }
            
            // دالة للحصول على الموقع الجغرافي للمستخدم
            function getCurrentLocation() {
                if (navigator.geolocation) {
                    gpsBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري تحديد الموقع...';
                    gpsBtn.disabled = true;
                    
                    navigator.geolocation.getCurrentPosition(
                        function(position) {
                            const lat = position.coords.latitude;
                            const lng = position.coords.longitude;
                            
                            // استخدام خدمة reverse geocoding للحصول على اسم المدينة
                            fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&accept-language=ar`)
                                .then(response => response.json())
                                .then(data => {
                                    const city = data.address.city || data.address.town || data.address.village || "موقعك الحالي";
                                    const country = data.address.country || "غير معروف";
                                    
                                    currentLocation = { lat, lng, city, country };
                                    loadPrayerTimes(currentLocation);
                                    
                                    gpsBtn.innerHTML = '<i class="fas fa-location-arrow"></i> استخدام موقعي الحالي';
                                    gpsBtn.disabled = false;
                                })
                                .catch(error => {
                                    console.error('Geocoding error:', error);
                                    currentLocation = { lat, lng, city: "موقعك الحالي", country: "" };
                                    loadPrayerTimes(currentLocation);
                                    
                                    gpsBtn.innerHTML = '<i class="fas fa-location-arrow"></i> استخدام موقعي الحالي';
                                    gpsBtn.disabled = false;
                                });
                        },
                        function(error) {
                            console.error('Geolocation error:', error);
                            showMessage('تعذر تحديد موقعك. يرجى السماح بالوصول إلى الموقع الجغرافي.', 'warning');
                            gpsBtn.innerHTML = '<i class="fas fa-location-arrow"></i> استخدام موقعي الحالي';
                            gpsBtn.disabled = false;
                        },
                        { timeout: 10000, enableHighAccuracy: true }
                    );
                } else {
                    showMessage('المتصفح لا يدعم تحديد الموقع الجغرافي.', 'warning');
                }
            }
            
            // دالة إظهار الرسائل
            function showMessage(message, type = 'info') {
                const messageDiv = document.createElement('div');
                messageDiv.className = type === 'success' ? 'success-message' : 'warning';
                messageDiv.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : 'info-circle'}"></i> ${message}`;
                messageDiv.style.position = 'fixed';
                messageDiv.style.top = '20px';
                messageDiv.style.left = '50%';
                messageDiv.style.transform = 'translateX(-50%)';
                messageDiv.style.zIndex = '1000';
                messageDiv.style.minWidth = '300px';
                messageDiv.style.textAlign = 'center';
                
                document.body.appendChild(messageDiv);
                
                setTimeout(() => {
                    messageDiv.remove();
                }, 3000);
            }
            
            // تحميل الموقع المحفوظ مسبقاً
            function loadSavedLocation() {
                const savedLocation = localStorage.getItem('lastPrayerLocation');
                if (savedLocation) {
                    currentLocation = JSON.parse(savedLocation);
                    loadPrayerTimes(currentLocation);
                } else {
                    // تحميل مكة المكرمة كموقع افتراضي
                    loadPrayerTimes(currentLocation);
                }
            }
            
            // إضافة مستمعي الأحداث
            gpsBtn.addEventListener('click', getCurrentLocation);
            
            makkahBtn.addEventListener('click', function() {
                currentLocation = { lat: 21.4225, lng: 39.8262, city: "مكة المكرمة", country: "السعودية" };
                loadPrayerTimes(currentLocation);
            });
            
            madinaBtn.addEventListener('click', function() {
                currentLocation = { lat: 24.4672, lng: 39.6111, city: "المدينة المنورة", country: "السعودية" };
                loadPrayerTimes(currentLocation);
            });
            
            citySelect.addEventListener('change', function() {
                if (this.value) {
                    const selectedOption = this.options[this.selectedIndex];
                    const cityName = selectedOption.text.split('،')[0]; // أخذ الجزء قبل الفاصلة
                    currentLocation = { city: this.value, country: "" };
                    loadPrayerTimes(currentLocation);
                }
            });
            
            // تحميل البيانات عند فتح الصفحة
            loadDates();
            loadSavedLocation();
            
            // تحديث التواريخ كل ساعة
            setInterval(loadDates, 60 * 60 * 1000);
        });
    </script>
</body>
</html>
